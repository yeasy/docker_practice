## 7.14 LABEL ä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®

æœ¬èŠ‚æ¶µç›–äº†ç›¸å…³å†…å®¹ä¸è¯¦ç»†æè¿°ï¼Œä¸»è¦æ¢è®¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

### åŸºæœ¬è¯­æ³•

å¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç›¸å…³ç¤ºä¾‹ï¼š

```docker
LABEL <key>=<value> <key>=<value> ...
```

`LABEL` æŒ‡ä»¤ä»¥é”®å€¼å¯¹çš„å½¢å¼ç»™é•œåƒæ·»åŠ å…ƒæ•°æ®ã€‚è¿™äº›æ•°æ®ä¸ä¼šå½±å“é•œåƒçš„åŠŸèƒ½ï¼Œä½†å¯ä»¥å¸®åŠ©ç”¨æˆ·ç†è§£é•œåƒï¼Œæˆ–è¢«è‡ªåŠ¨åŒ–å·¥å…·ä½¿ç”¨ã€‚

---

### ä¸ºä»€ä¹ˆéœ€è¦ LABEL

1. **ç‰ˆæœ¬ç®¡ç†**ï¼šè®°å½•ç‰ˆæœ¬å·ã€æ„å»ºæ—¶é—´ã€Git Commit ID
2. **è”ç³»ä¿¡æ¯**ï¼šç»´æŠ¤è€…é‚®ç®±ã€æ–‡æ¡£åœ°å€ã€æ”¯æŒæ¸ é“
3. **è‡ªåŠ¨åŒ–å·¥å…·**ï¼šCI/CD å·¥å…·å¯ä»¥è¯»å–æ ‡ç­¾è§¦å‘æ“ä½œ
4. **è®¸å¯è¯ä¿¡æ¯**ï¼šå£°æ˜å¼€æºåè®®

---

### åŸºæœ¬ç”¨æ³•

æœ¬èŠ‚æ¶µç›–äº†ç›¸å…³å†…å®¹ä¸è¯¦ç»†æè¿°ï¼Œä¸»è¦æ¢è®¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

#### å®šä¹‰å•ä¸ªæ ‡ç­¾

å¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç›¸å…³ç¤ºä¾‹ï¼š

```docker
LABEL version="1.0"
LABEL description="è¿™æ˜¯ä¸€ä¸ª Web åº”ç”¨æœåŠ¡å™¨"
```

#### å®šä¹‰å¤šä¸ªæ ‡ç­¾ (æ¨è)

å¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç›¸å…³ç¤ºä¾‹ï¼š

```docker
LABEL maintainer="user@example.com" \
      version="1.2.0" \
      description="My App Description" \
      org.opencontainers.image.authors="Yeasy"
```

> ğŸ’¡ åŒ…å«ç©ºæ ¼çš„å€¼éœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚

---

### å¸¸ç”¨æ ‡ç­¾è§„èŒƒ

ä¸ºäº†æ ‡å‡†å’Œäº’æ“ä½œæ€§ï¼Œæ¨èä½¿ç”¨ [OCI Image Format Specification](https://github.com/opencontainers/image-spec/blob/main/annotations.md#pre-defined-annotation-keys) å®šä¹‰çš„æ ‡å‡†æ ‡ç­¾ï¼š

| æ ‡ç­¾ Key | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|
| `org.opencontainers.image.created` | æ„å»ºæ—¶é—´(RFC 3339) | `2024-01-01T00:00:00Z` |
| `org.opencontainers.image.authors` | ä½œè€…/ç»´æŠ¤è€… | `support@example.com` |
| `org.opencontainers.image.url` | é¡¹ç›®ä¸»é¡µ | `https://example.com` |
| `org.opencontainers.image.documentation`| æ–‡æ¡£åœ°å€ | `https://example.com/docs` |
| `org.opencontainers.image.source` | æºç ä»“åº“ | `https://github.com/user/repo` |
| `org.opencontainers.image.version` | ç‰ˆæœ¬å· | `1.0.0` |
| `org.opencontainers.image.licenses` | è®¸å¯è¯ | `MIT` |
| `org.opencontainers.image.title` | é•œåƒæ ‡é¢˜ | `My App` |
| `org.opencontainers.image.description` | æè¿° | `Production ready web server` |

#### æ¦‚è¿°

æ€»ä½“æ¦‚è¿°äº†ä»¥ä¸‹å†…å®¹ã€‚

#### ç¤ºä¾‹

å¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç›¸å…³ç¤ºä¾‹ï¼š

```docker
LABEL org.opencontainers.image.authors="yeasy" \
      org.opencontainers.image.documentation="https://yeasy.gitbooks.io" \
      org.opencontainers.image.source="https://github.com/yeasy/docker_practice" \
      org.opencontainers.image.licenses="MIT"
```

---

### MAINTAINER æŒ‡ä»¤ (å·²åºŸå¼ƒ)

æ—§ç‰ˆæœ¬çš„ Dockerfile ä¸­å¸¸çœ‹åˆ° `MAINTAINER` æŒ‡ä»¤ï¼š

```docker
## âŒ å·²å¼ƒç”¨

MAINTAINER user@example.com
```

ç°åœ¨æ¨èä½¿ç”¨ `LABEL`ï¼š

```docker
## âœ… æ¨è

LABEL maintainer="user@example.com"
## æˆ–

LABEL org.opencontainers.image.authors="user@example.com"
```

---

### åŠ¨æ€æ ‡ç­¾

 é…åˆ `ARG` ä½¿ç”¨ï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶åŠ¨æ€æ³¨å…¥æ ‡ç­¾ï¼š

```docker
ARG BUILD_DATE
ARG VCS_REF

LABEL org.opencontainers.image.created=$BUILD_DATE \
      org.opencontainers.image.revision=$VCS_REF
```

æ„å»ºå‘½ä»¤ï¼š

```bash
$ docker build \
  --build-arg BUILD_DATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ') \
  --build-arg VCS_REF=$(git rev-parse --short HEAD) \
  .
```

---

### æŸ¥çœ‹æ ‡ç­¾

æœ¬èŠ‚æ¶µç›–äº†ç›¸å…³å†…å®¹ä¸è¯¦ç»†æè¿°ï¼Œä¸»è¦æ¢è®¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

#### docker inspect

æŸ¥çœ‹é•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼š

```bash
$ docker inspect nginx --format '{{json .Config.Labels}}' | jq
{
  "maintainer": "NGINX Docker Maintainers <docker-maint@nginx.com>"
}
```

#### è¿‡æ»¤å™¨

å¯ä»¥ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤é•œåƒï¼š

```bash
## åˆ—å‡ºä½œè€…æ˜¯ yeasy çš„æ‰€æœ‰é•œåƒ

$ docker images --filter "label=org.opencontainers.image.authors=yeasy"

## åˆ é™¤æ‰€æœ‰å¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„é•œåƒ

$ docker rmi $(docker images -q --filter "label=stage=builder")
```

---
