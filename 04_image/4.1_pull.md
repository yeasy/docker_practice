## 4.1 è·å–é•œåƒ

ä» Docker é•œåƒä»“åº“è·å–é•œåƒå¯è°“æ˜¯ Docker è¿ä½œçš„ç¬¬ä¸€æ­¥ã€‚æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ `docker pull` å‘½ä»¤ä¸‹è½½é•œåƒï¼Œä»¥åŠå¦‚ä½•ç†è§£ä¸‹è½½è¿‡ç¨‹ã€‚

### docker pull å‘½ä»¤

ä»é•œåƒä»“åº“è·å–é•œåƒçš„å‘½ä»¤æ˜¯ `docker pull`ï¼š

```bash
docker pull [é€‰é¡¹] [Registryåœ°å€/]ä»“åº“å[:æ ‡ç­¾]
```

#### é•œåƒåç§°æ ¼å¼

Docker é•œåƒåç§°ç”± Registry åœ°å€ã€ç”¨æˆ·åã€ä»“åº“åå’Œæ ‡ç­¾ç»„æˆã€‚å…¶æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š

```bash
docker.io / library / ubuntu : 24.04
â”€â”€â”€â”€â”¬â”€â”€â”€â”€   â”€â”€â”€â”¬â”€â”€â”€   â”€â”€â”¬â”€â”€â”€   â”€â”€â”¬â”€â”€
    â”‚         â”‚        â”‚        â”‚
Registryåœ°å€  ç”¨æˆ·å    ä»“åº“å    æ ‡ç­¾
 (å¯çœç•¥)    (å¯çœç•¥)
```

| ç»„æˆéƒ¨åˆ† | è¯´æ˜ | é»˜è®¤å€¼ |
|---------|------|--------|
| Registry åœ°å€ | é•œåƒä»“åº“åœ°å€ | `docker.io` (Docker Hub)|
| ç”¨æˆ·å | é•œåƒæ‰€å±ç”¨æˆ·/ç»„ç»‡ | `library` (å®˜æ–¹é•œåƒ)|
| ä»“åº“å | é•œåƒåç§° | å¿…é¡»æŒ‡å®š |
| æ ‡ç­¾ | ç‰ˆæœ¬æ ‡è¯† | `latest` |

#### ç¤ºä¾‹

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
## å®Œæ•´æ ¼å¼

$ docker pull docker.io/library/ubuntu:24.04

## çœç•¥ Registryï¼ˆé»˜è®¤ Docker Hubï¼‰

$ docker pull library/ubuntu:24.04

## çœç•¥ libraryï¼ˆå®˜æ–¹é•œåƒï¼‰

$ docker pull ubuntu:24.04

## çœç•¥æ ‡ç­¾ï¼ˆé»˜è®¤ latestï¼‰

$ docker pull ubuntu

## æ‹‰å–ç¬¬ä¸‰æ–¹é•œåƒ

$ docker pull bitnami/redis:latest

## ä»å…¶ä»– Registry æ‹‰å–

$ docker pull ghcr.io/username/myapp:v1.0
```

---

### ä¸‹è½½è¿‡ç¨‹è§£æ

å½“æˆ‘ä»¬æ‰§è¡Œ `docker pull` å‘½ä»¤æ—¶ï¼ŒDocker ä¼šè¾“å‡ºè¯¦ç»†çš„ä¸‹è½½è¿›åº¦ã€‚è®©æˆ‘ä»¬ä»¥ `ubuntu:24.04` ä¸ºä¾‹æ¥è§£æè¿™äº›ä¿¡æ¯ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
$ docker pull ubuntu:24.04
24.04: Pulling from library/ubuntu
92dc2a97ff99: Pull complete
be13a9d27eb8: Pull complete
c8299583700a: Pull complete
Digest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26
Status: Downloaded newer image for ubuntu:24.04
docker.io/library/ubuntu:24.04
```

#### è¾“å‡ºè§£è¯»

ç›¸å…³ä¿¡æ¯å¦‚ä¸‹è¡¨ï¼š

| è¾“å‡ºå†…å®¹ | è¯´æ˜ |
|---------|------|
| `Pulling from library/ubuntu` | æ­£åœ¨ä»å®˜æ–¹ ubuntu ä»“åº“æ‹‰å– |
| `92dc2a97ff99: Pull complete` | å„å±‚çš„ä¸‹è½½çŠ¶æ€ (æ˜¾ç¤ºå±‚ ID å‰ 12 ä½)|
| `Digest: sha256:...` | é•œåƒå†…å®¹çš„å”¯ä¸€æ‘˜è¦ |
| `docker.io/library/ubuntu:24.04` | é•œåƒçš„å®Œæ•´åç§° |

#### åˆ†å±‚ä¸‹è½½

ä»è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œé•œåƒæ˜¯ **åˆ†å±‚ä¸‹è½½** çš„ï¼š

```mermaid
flowchart TD
    subgraph Image ["ubuntu:24.04 é•œåƒ"]
        direction TB
        L3["ç¬¬3å±‚ c8299583700a<br/>(å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½)"]
        L2["ç¬¬2å±‚ be13a9d27eb8<br/>(ä¸‹è½½ä¸­... å®Œæˆ)"]
        L1["ç¬¬1å±‚ 92dc2a97ff99<br/>(ä¸‹è½½ä¸­... å®Œæˆ)"]
        L3 --- L2 --- L1
    end
```

å¦‚æœæœ¬åœ°å·²æœ‰ç›¸åŒçš„å±‚ï¼ŒDocker ä¼šè·³è¿‡ä¸‹è½½ï¼ŒèŠ‚çœå¸¦å®½å’Œæ—¶é—´ã€‚

---

### å¸¸ç”¨é€‰é¡¹

`docker pull` å‘½ä»¤æ”¯æŒå¤šç§é€‰é¡¹æ¥æ»¡è¶³ä¸åŒçš„ä¸‹è½½éœ€æ±‚ï¼Œä¾‹å¦‚ä¸‹è½½æ‰€æœ‰æ ‡ç­¾ã€æŒ‡å®šå¹³å°æ¶æ„ç­‰ã€‚

| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--all-tags, -a` | æ‹‰å–æ‰€æœ‰æ ‡ç­¾ | `docker pull -a ubuntu` |
| `--platform` | æŒ‡å®šå¹³å°æ¶æ„ | `docker pull --platform linux/arm64 nginx` |
| `--quiet, -q` | é™é»˜æ¨¡å¼ | `docker pull -q nginx` |

#### æ¦‚è¿°

æ€»ä½“æ¦‚è¿°äº†ä»¥ä¸‹å†…å®¹ã€‚

#### æŒ‡å®šå¹³å°

åœ¨ Apple Silicon Mac ä¸Šæ‹‰å– x86 é•œåƒï¼š

```bash
$ docker pull --platform linux/amd64 nginx
```

---

### æ‹‰å–åè¿è¡Œ

æ‹‰å–é•œåƒåï¼Œå¯ä»¥åŸºäºå®ƒå¯åŠ¨å®¹å™¨ï¼š

```bash
## æ‹‰å–é•œåƒ

$ docker pull ubuntu:24.04

## è¿è¡Œå®¹å™¨

$ docker run -it --rm ubuntu:24.04 bash
root@e7009c6ce357:/# cat /etc/os-release
PRETTY_NAME="Ubuntu 24.04 LTS"
...
root@e7009c6ce357:/# exit
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ |
|------|------|
| `-it` | äº¤äº’å¼ç»ˆç«¯æ¨¡å¼ |
| `--rm` | é€€å‡ºåè‡ªåŠ¨åˆ é™¤å®¹å™¨ |
| `bash` | å¯åŠ¨å‘½ä»¤ |

> ğŸ’¡ `docker run` åœ¨éœ€è¦æ—¶ä¼šè‡ªåŠ¨ `pull` é•œåƒï¼Œå› æ­¤é€šå¸¸ä¸éœ€è¦å•ç‹¬æ‰§è¡Œ `docker pull`ã€‚

---

### é•œåƒåŠ é€Ÿ

ä» Docker Hub ä¸‹è½½å¯èƒ½è¾ƒæ…¢ã€‚å¯ä»¥é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼š

```json
// /etc/docker/daemon.json (Linux)
// ~/.docker/daemon.json (Docker Desktop)
{
  "registry-mirrors": [
    "https://your-accelerator-url"
  ]
}
```

é…ç½®åé‡å¯ Dockerï¼š

```bash
$ sudo systemctl restart docker  # Linux
## æˆ–åœ¨ Docker Desktop ä¸­é‡å¯

## æˆ–åœ¨ Docker Desktop ä¸­é‡å¯

```

è¯¦è§[é•œåƒåŠ é€Ÿå™¨](../03_install/3.9_mirror.md)ç« èŠ‚ã€‚

---

### éªŒè¯é•œåƒå®Œæ•´æ€§

ä¸ºäº†ç¡®ä¿ä¸‹è½½çš„é•œåƒæ²¡æœ‰è¢«ç¯¡æ”¹ä¸”å†…å®¹ä¸€è‡´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¡éªŒé•œåƒçš„æ‘˜è¦ (Digest)ã€‚

#### æŸ¥çœ‹é•œåƒæ‘˜è¦

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
$ docker images --digests ubuntu
REPOSITORY   TAG     DIGEST                                                                    IMAGE ID
ubuntu       24.04   sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26   ca2b0f26964c
```

#### ä½¿ç”¨æ‘˜è¦æ‹‰å–

ç”¨æ‘˜è¦æ‹‰å–å¯ç¡®ä¿è·å–å®Œå…¨ç›¸åŒçš„é•œåƒï¼š

```bash
$ docker pull ubuntu@sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26
```

> ç¬”è€…å»ºè®®ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ‘˜è¦è€Œéæ ‡ç­¾ï¼Œå› ä¸ºæ ‡ç­¾å¯èƒ½è¢«è¦†ç›–ï¼Œæ‘˜è¦åˆ™æ˜¯ä¸å¯å˜çš„ã€‚

---

### å¸¸è§é—®é¢˜

åœ¨ä½¿ç”¨ `docker pull` è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹è½½é€Ÿåº¦æ…¢ã€é•œåƒä¸å­˜åœ¨æˆ–ç£ç›˜ç©ºé—´ä¸è¶³ç­‰é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é—®é¢˜çš„æ’æŸ¥æ€è·¯ã€‚

#### Qï¼šä¸‹è½½é€Ÿåº¦å¾ˆæ…¢

1. é…ç½®é•œåƒåŠ é€Ÿå™¨
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. å°è¯•æ‹‰å–æ›´å°çš„é•œåƒç‰ˆæœ¬ (å¦‚ `alpine` å˜ä½“)

#### Qï¼šæç¤ºé•œåƒä¸å­˜åœ¨

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
Error: pull access denied, repository does not exist
```

å¯èƒ½åŸå› ï¼š

- é•œåƒåæ‹¼å†™é”™è¯¯
- ç§æœ‰é•œåƒæœªç™»å½• (éœ€è¦ `docker login`)
- é•œåƒç¡®å®ä¸å­˜åœ¨

#### Qï¼šç£ç›˜ç©ºé—´ä¸è¶³

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
## æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ

$ docker image prune

## æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº

$ docker system prune
```

---
