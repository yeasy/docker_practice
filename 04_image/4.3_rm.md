## åˆ é™¤æœ¬åœ°é•œåƒ

### åŸºæœ¬ç”¨æ³•

ä½¿ç”¨ `docker image rm` åˆ é™¤æœ¬åœ°é•œåƒï¼š

```bash
$ docker image rm [é€‰é¡¹] <é•œåƒ1> [<é•œåƒ2> ...]
```

> ğŸ’¡ `docker rmi` æ˜¯ `docker image rm` çš„ç®€å†™ï¼Œä¸¤è€…ç­‰æ•ˆã€‚

---

### é•œåƒæ ‡è¯†æ–¹å¼

åˆ é™¤é•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æŒ‡å®šé•œåƒï¼š

| æ–¹å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **çŸ­ ID** | ID çš„å‰å‡ ä½ï¼ˆé€šå¸¸ 3-4 ä½ï¼‰ | `docker rmi 501` |
| **é•¿ ID** | å®Œæ•´çš„é•œåƒ ID | `docker rmi 501ad78535f0...` |
| **é•œåƒå:æ ‡ç­¾** | ä»“åº“åå’Œæ ‡ç­¾ | `docker rmi redis:alpine` |
| **é•œåƒæ‘˜è¦** | ç²¾ç¡®çš„å†…å®¹æ‘˜è¦ | `docker rmi nginx@sha256:...` |

#### ä½¿ç”¨çŸ­ ID åˆ é™¤

```bash
$ docker image ls
REPOSITORY   TAG     IMAGE ID       SIZE
redis        alpine  501ad78535f0   30MB
nginx        latest  e43d811ce2f4   142MB

## åªéœ€è¾“å…¥è¶³å¤ŸåŒºåˆ†çš„å‰å‡ ä½
$ docker rmi 501
Untagged: redis:alpine
Deleted: sha256:501ad78535f0...
```

#### ä½¿ç”¨é•œåƒååˆ é™¤

```bash
$ docker rmi redis:alpine
Untagged: redis:alpine
Deleted: sha256:501ad78535f0...
```

#### ä½¿ç”¨æ‘˜è¦åˆ é™¤

æ‘˜è¦åˆ é™¤æœ€ç²¾ç¡®ï¼Œé€‚ç”¨äº CI/CD åœºæ™¯ï¼š

```bash
## æŸ¥çœ‹é•œåƒæ‘˜è¦
$ docker images --digests
REPOSITORY   TAG    DIGEST                   IMAGE ID
nginx        latest sha256:b4f0e0bdeb5...    e43d811ce2f4

## ä½¿ç”¨æ‘˜è¦åˆ é™¤
$ docker rmi nginx@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228
```

---

### ç†è§£è¾“å‡ºä¿¡æ¯

åˆ é™¤é•œåƒæ—¶ä¼šçœ‹åˆ°ä¸¤ç±»ä¿¡æ¯ï¼š**Untagged** å’Œ **Deleted**

```bash
$ docker rmi redis:alpine
Untagged: redis:alpine
Untagged: redis@sha256:f1ed3708f538b537eb9c2a7dd50dc90a706f7debd7e1196c9264edeea521a86d
Deleted: sha256:501ad78535f015d88872e13fa87a828425117e3d28075d0c117932b05bf189b7
Deleted: sha256:96167737e29ca8e9d74982ef2a0dda76ed7b430da55e321c071f0dbff8c2899b
Deleted: sha256:32770d1dcf835f192cafd6b9263b7b597a1778a403a109e2cc2ee866f74adf23
```

#### Untagged vs Deleted

| æ“ä½œ | å«ä¹‰ |
|------|------|
| **Untagged** | ç§»é™¤é•œåƒçš„æ ‡ç­¾ |
| **Deleted** | åˆ é™¤é•œåƒçš„å­˜å‚¨å±‚ |

#### åˆ é™¤æµç¨‹

```
docker rmi redis:alpine
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Untagï¼šç§»é™¤ redis:alpine æ ‡ç­¾                              â”‚
â”‚       â†“                                                       â”‚
â”‚  2. æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–æ ‡ç­¾æŒ‡å‘è¿™ä¸ªé•œåƒ                             â”‚
â”‚       â”œâ”€â”€ æœ‰ â†’ åª Untagï¼Œä¸åˆ é™¤                                â”‚
â”‚       â””â”€â”€ æ—  â†’                                                â”‚
â”‚             â†“                                                 â”‚
â”‚  3. æ£€æŸ¥æ˜¯å¦æœ‰å®¹å™¨ä¾èµ–                                          â”‚
â”‚       â”œâ”€â”€ æœ‰ â†’ æŠ¥é”™ï¼Œæ— æ³•åˆ é™¤                                  â”‚
â”‚       â””â”€â”€ æ—  â†’                                                â”‚
â”‚             â†“                                                 â”‚
â”‚  4. ä»ä¸Šåˆ°ä¸‹é€å±‚åˆ é™¤ï¼Œæ£€æŸ¥æ¯å±‚æ˜¯å¦è¢«å…¶ä»–é•œåƒä½¿ç”¨                   â”‚
â”‚       â”œâ”€â”€ è¢«ä½¿ç”¨ â†’ ä¿ç•™                                       â”‚
â”‚       â””â”€â”€ æœªä½¿ç”¨ â†’ Deleted                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ‰¹é‡åˆ é™¤

#### åˆ é™¤æ‰€æœ‰è™šæ‚¬é•œåƒ

è™šæ‚¬é•œåƒï¼ˆdanglingï¼‰ï¼šæ²¡æœ‰æ ‡ç­¾çš„é•œåƒï¼Œé€šå¸¸æ˜¯æ—§ç‰ˆæœ¬è¢«æ–°ç‰ˆæœ¬è¦†ç›–åäº§ç”Ÿçš„

```bash
## æŸ¥çœ‹è™šæ‚¬é•œåƒ
$ docker images -f dangling=true

## åˆ é™¤è™šæ‚¬é•œåƒ
$ docker image prune

## ä¸æç¤ºç¡®è®¤
$ docker image prune -f
```

#### åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ

```bash
## åˆ é™¤æ‰€æœ‰æ²¡æœ‰è¢«å®¹å™¨ä½¿ç”¨çš„é•œåƒ
$ docker image prune -a

## ä¿ç•™æœ€è¿‘ 24 å°æ—¶çš„
$ docker image prune -a --filter "until=24h"
```

#### æŒ‰æ¡ä»¶åˆ é™¤

```bash
## åˆ é™¤æ‰€æœ‰ redis é•œåƒ
$ docker rmi $(docker images -q redis)

## åˆ é™¤ mongo:8.0 ä¹‹å‰çš„æ‰€æœ‰é•œåƒ
$ docker rmi $(docker images -q -f before=mongo:8.0)

## åˆ é™¤æŸä¸ªæ—¶é—´ä¹‹å‰çš„é•œåƒ
$ docker image prune -a --filter "until=168h"  # 7å¤©å‰
```

---

### åˆ é™¤å¤±è´¥çš„å¸¸è§åŸå› 

#### åŸå› ä¸€ï¼šæœ‰å®¹å™¨ä¾èµ–

```bash
$ docker rmi nginx
Error: conflict: unable to remove repository reference "nginx" 
(must force) - container abc123 is using its referenced image
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
## æ–¹æ¡ˆ1ï¼šå…ˆåˆ é™¤ä¾èµ–çš„å®¹å™¨
$ docker rm abc123
$ docker rmi nginx

## æ–¹æ¡ˆ2ï¼šå¼ºåˆ¶åˆ é™¤é•œåƒï¼ˆå®¹å™¨ä»å¯è¿è¡Œï¼Œä½†æ— æ³•å†åˆ›å»ºæ–°å®¹å™¨ï¼‰
$ docker rmi -f nginx
```

#### åŸå› äºŒï¼šå¤šä¸ªæ ‡ç­¾æŒ‡å‘åŒä¸€é•œåƒ

```bash
$ docker images
REPOSITORY   TAG     IMAGE ID
ubuntu       24.04   ca2b0f26964c
ubuntu       latest  ca2b0f26964c   # åŒä¸€ä¸ªé•œåƒ

$ docker rmi ubuntu:24.04
Untagged: ubuntu:24.04
## åªæ˜¯ç§»é™¤æ ‡ç­¾ï¼Œé•œåƒä»å­˜åœ¨ï¼ˆå› ä¸ºè¿˜æœ‰ ubuntu:latest æŒ‡å‘å®ƒï¼‰
```

#### åŸå› ä¸‰ï¼šè¢«å…¶ä»–é•œåƒä¾èµ–ï¼ˆä¸­é—´å±‚ï¼‰

```bash
$ docker rmi some_base_image
Error: image has dependent child images
```

ä¸­é—´å±‚é•œåƒè¢«å…¶ä»–é•œåƒä¾èµ–ï¼Œæ— æ³•åˆ é™¤ã€‚éœ€è¦å…ˆåˆ é™¤ä¾èµ–å®ƒçš„é•œåƒã€‚

---

### å¸¸ç”¨è¿‡æ»¤æ¡ä»¶

| è¿‡æ»¤æ¡ä»¶ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| `dangling=true` | è™šæ‚¬é•œåƒ | `-f dangling=true` |
| `before=é•œåƒ` | åœ¨æŸé•œåƒä¹‹å‰ | `-f before=mongo:3.2` |
| `since=é•œåƒ` | åœ¨æŸé•œåƒä¹‹å | `-f since=mongo:3.2` |
| `label=key=value` | æŒ‰æ ‡ç­¾è¿‡æ»¤ | `-f label=version=1.0` |
| `reference=pattern` | æŒ‰åç§°æ¨¡å¼ | `-f reference='*:latest'` |

---

### æ¸…ç†ç­–ç•¥

#### å¼€å‘ç¯å¢ƒ

```bash
## å®šæœŸæ¸…ç†è™šæ‚¬é•œåƒ
$ docker image prune -f

## ä¸€é”®æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº
$ docker system prune -a
```

#### CI/CD ç¯å¢ƒ

```bash
## åªä¿ç•™æœ€è¿‘ä½¿ç”¨çš„é•œåƒ
$ docker image prune -a --filter "until=72h" -f
```

#### æŸ¥çœ‹ç©ºé—´å ç”¨

```bash
$ docker system df
TYPE            TOTAL   ACTIVE   SIZE      RECLAIMABLE
Images          15      3        2.5GB     1.8GB (72%)
Containers      5       2        100MB     80MB (80%)
Local Volumes   8       2        500MB     400MB (80%)
Build Cache     0       0        0B        0B
```

---

### æœ¬ç« å°ç»“

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| åˆ é™¤æŒ‡å®šé•œåƒ | `docker rmi é•œåƒå:æ ‡ç­¾` |
| å¼ºåˆ¶åˆ é™¤ | `docker rmi -f é•œåƒå` |
| åˆ é™¤è™šæ‚¬é•œåƒ | `docker image prune` |
| åˆ é™¤æœªä½¿ç”¨é•œåƒ | `docker image prune -a` |
| æ‰¹é‡åˆ é™¤ | `docker rmi $(docker images -q -f ...)` |
| æŸ¥çœ‹ç©ºé—´å ç”¨ | `docker system df` |

### å»¶ä¼¸é˜…è¯»

- [åˆ—å‡ºé•œåƒ](4.2_list.md)ï¼šæŸ¥çœ‹å’Œè¿‡æ»¤é•œåƒ
- [åˆ é™¤å®¹å™¨](../05_container/4.3_rm.md)ï¼šæ¸…ç†å®¹å™¨
- [æ•°æ®å·](../07_data_network/data/volume.md)ï¼šæ¸…ç†æ•°æ®å·
