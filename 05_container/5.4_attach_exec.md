## è¿›å…¥å®¹å™¨

### ä¸ºä»€ä¹ˆéœ€è¦è¿›å…¥å®¹å™¨

ä½¿ç”¨ `-d` å‚æ•°å¯åŠ¨å®¹å™¨åï¼Œå®¹å™¨åœ¨åå°è¿è¡Œã€‚ä»¥ä¸‹åœºæ™¯éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨æ“ä½œï¼š

| åœºæ™¯ | ç¤ºä¾‹ |
|------|------|
| **è°ƒè¯•é—®é¢˜** | æŸ¥çœ‹æ—¥å¿—ã€æ£€æŸ¥é…ç½®ã€æ’æŸ¥é”™è¯¯ |
| **ä¸´æ—¶æ“ä½œ** | æ‰§è¡Œæ•°æ®åº“è¿ç§»ã€æ¸…ç†ç¼“å­˜ |
| **æ£€æŸ¥çŠ¶æ€** | æŸ¥çœ‹è¿›ç¨‹ã€ç½‘ç»œè¿æ¥ã€æ–‡ä»¶ç³»ç»Ÿ |
| **å¼€å‘æµ‹è¯•** | äº¤äº’å¼æµ‹è¯•å‘½ä»¤ã€éªŒè¯ç¯å¢ƒ |

### ä¸¤ç§è¿›å…¥æ–¹å¼

Docker æä¾›ä¸¤ç§è¿›å…¥å®¹å™¨çš„å‘½ä»¤ï¼š

| å‘½ä»¤ | æ¨èç¨‹åº¦ | ç‰¹ç‚¹ |
|------|---------|------|
| `docker exec` | âœ… **æ¨è** | å¯åŠ¨æ–°è¿›ç¨‹ï¼Œé€€å‡ºä¸å½±å“å®¹å™¨ |
| `docker attach` | âš ï¸ è°¨æ…ä½¿ç”¨ | é™„åŠ åˆ°ä¸»è¿›ç¨‹ï¼Œé€€å‡ºå¯èƒ½åœæ­¢å®¹å™¨ |

---

### docker execï¼ˆæ¨èï¼‰

#### åŸºæœ¬ç”¨æ³•

```bash
## è¿›å…¥å®¹å™¨å¹¶å¯åŠ¨äº¤äº’å¼ shell
$ docker exec -it å®¹å™¨å /bin/bash

## æˆ–ä½¿ç”¨ shï¼ˆé€‚ç”¨äº Alpine ç­‰ç²¾ç®€é•œåƒï¼‰
$ docker exec -it å®¹å™¨å /bin/sh
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ä½œç”¨ |
|------|------|
| `-i` | ä¿æŒæ ‡å‡†è¾“å…¥æ‰“å¼€ï¼ˆinteractiveï¼‰ |
| `-t` | åˆ†é…ä¼ªç»ˆç«¯ï¼ˆTTYï¼‰ |
| `-it` | ä¸¤è€…ç»„åˆï¼Œè·å¾—å®Œæ•´äº¤äº’ä½“éªŒ |
| `-u` | æŒ‡å®šç”¨æˆ·ï¼ˆå¦‚ `-u root`ï¼‰ |
| `-w` | æŒ‡å®šå·¥ä½œç›®å½• |
| `-e` | è®¾ç½®ç¯å¢ƒå˜é‡ |

#### ç¤ºä¾‹

```bash
## å¯åŠ¨ä¸€ä¸ªåå°å®¹å™¨
$ docker run -dit --name myubuntu ubuntu
69d137adef7a...

## è¿›å…¥å®¹å™¨ï¼ˆäº¤äº’å¼ shellï¼‰
$ docker exec -it myubuntu bash
root@69d137adef7a:/# ls
bin  boot  dev  etc  home  lib  ...
root@69d137adef7a:/# exit

## å®¹å™¨ä»åœ¨è¿è¡Œï¼
$ docker ps
CONTAINER ID   IMAGE    STATUS         NAMES
69d137adef7a   ubuntu   Up 2 minutes   myubuntu
```

#### æ‰§è¡Œå•æ¡å‘½ä»¤

ä¸è¿›å…¥äº¤äº’æ¨¡å¼ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š

```bash
## æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹
$ docker exec myubuntu ps aux

## æŸ¥çœ‹é…ç½®æ–‡ä»¶
$ docker exec myubuntu cat /etc/nginx/nginx.conf

## ä»¥ root ç”¨æˆ·æ‰§è¡Œ
$ docker exec -u root myubuntu apt update
```

#### åªç”¨ -i ä¸ç”¨ -t çš„åŒºåˆ«

```bash
## åªç”¨ -iï¼šå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ²¡æœ‰æç¤ºç¬¦
$ docker exec -i myubuntu bash
ls           # è¾“å…¥å‘½ä»¤
bin          # è¾“å‡ºç»“æœ
boot
dev
...

## ç”¨ -itï¼šæœ‰å®Œæ•´çš„ç»ˆç«¯ä½“éªŒ
$ docker exec -it myubuntu bash
root@69d137adef7a:/#    # æœ‰æç¤ºç¬¦
```

> ğŸ’¡ é€šå¸¸ä½¿ç”¨ `-it` ç»„åˆã€‚åªæœ‰åœ¨è„šæœ¬ä¸­éœ€è¦é€šè¿‡ç®¡é“ä¼ å…¥å‘½ä»¤æ—¶æ‰åªç”¨ `-i`ã€‚

---

### docker attachï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

#### åŸºæœ¬ç”¨æ³•

```bash
$ docker attach å®¹å™¨å
```

#### å·¥ä½œåŸç†

`attach` ä¼šé™„åŠ åˆ°å®¹å™¨çš„**ä¸»è¿›ç¨‹**ï¼ˆPID 1ï¼‰çš„æ ‡å‡†è¾“å…¥è¾“å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®¹å™¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PID 1: /bin/bash (ä¸»è¿›ç¨‹)       â”‚â—„â”€â”€â”€â”¼â”€â”€â”€ docker attach é™„åŠ åˆ°è¿™é‡Œ
â”‚  â”‚    â””â”€ ä½ çš„è¾“å…¥ç›´æ¥å‘é€åˆ°ä¸»è¿›ç¨‹    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¤ºä¾‹

```bash
## å¯åŠ¨å®¹å™¨
$ docker run -dit --name myubuntu ubuntu
243c32535da7...

## é™„åŠ åˆ°å®¹å™¨
$ docker attach myubuntu
root@243c32535da7:/#
```

#### âš ï¸ é‡è¦è­¦å‘Š

**ä» attach ä¼šè¯ä¸­è¾“å…¥ `exit` æˆ–æŒ‰ `Ctrl+D` ä¼šå¯¼è‡´å®¹å™¨åœæ­¢ï¼**

```bash
$ docker attach myubuntu
root@243c32535da7:/# exit    # è¿™ä¼šåœæ­¢å®¹å™¨ï¼

$ docker ps
CONTAINER ID   IMAGE    STATUS                     NAMES
243c32535da7   ubuntu   Exited (0) 2 seconds ago   myubuntu
```

**åŸå› **ï¼šattach é™„åŠ åˆ°ä¸»è¿›ç¨‹ï¼Œé€€å‡ºä¸»è¿›ç¨‹å°±ç­‰äºé€€å‡ºå®¹å™¨ã€‚

#### å®‰å…¨é€€å‡º attach

ä½¿ç”¨ `Ctrl+P` ç„¶å `Ctrl+Q` å¯ä»¥ä» attach ä¼šè¯ä¸­**åˆ†ç¦»**ï¼Œè€Œä¸åœæ­¢å®¹å™¨ï¼š

```bash
$ docker attach myubuntu
root@243c32535da7:/# 
## æŒ‰ Ctrl+P ç„¶å Ctrl+Q
read escape sequence

$ docker ps    # å®¹å™¨ä»åœ¨è¿è¡Œ
CONTAINER ID   IMAGE    STATUS         NAMES
243c32535da7   ubuntu   Up 5 minutes   myubuntu
```

---

### exec vs attach å¯¹æ¯”

| ç‰¹æ€§ | docker exec | docker attach |
|------|-------------|---------------|
| **å·¥ä½œæ–¹å¼** | åœ¨å®¹å™¨å†…å¯åŠ¨æ–°è¿›ç¨‹ | é™„åŠ åˆ°ä¸»è¿›ç¨‹ |
| **é€€å‡ºå½±å“** | ä¸å½±å“å®¹å™¨ | å¯èƒ½åœæ­¢å®¹å™¨ |
| **å¤šç»ˆç«¯** | å¯ä»¥å¼€å¤šä¸ª | å…±äº«åŒä¸€ä¸ªä¼šè¯ |
| **é€‚ç”¨åœºæ™¯** | è°ƒè¯•ã€ä¸´æ—¶æ“ä½œ | æŸ¥çœ‹ä¸»è¿›ç¨‹è¾“å‡º |
| **æ¨èç¨‹åº¦** | âœ… æ¨è | âš ï¸ ç‰¹æ®Šåœºæ™¯ä½¿ç”¨ |

```
docker exec                           docker attach
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å®¹å™¨           â”‚               â”‚      å®¹å™¨           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PID 1: nginx  â”‚  â”‚               â”‚  â”‚ PID 1: bash   â”‚â—„â”€â”¼â”€â”€ é™„åŠ åˆ°ä¸»è¿›ç¨‹
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ PID 50: bash  â”‚â—„â”€â”¼â”€â”€ æ–°è¿›ç¨‹      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é€€å‡º bash ä¸å½±å“ nginx                 é€€å‡º bash å®¹å™¨åœæ­¢
```

---

### æœ€ä½³å®è·µ

#### 1. é¦–é€‰ docker exec

```bash
## è¿›å…¥å®¹å™¨è°ƒè¯•
$ docker exec -it myapp bash

## æŸ¥çœ‹æ—¥å¿—
$ docker exec myapp tail -f /var/log/app.log

## æ‰§è¡Œæ•°æ®åº“è¿ç§»
$ docker exec myapp python manage.py migrate
```

#### 2. ç”Ÿäº§ç¯å¢ƒé¿å…è¿›å…¥å®¹å™¨

ç¬”è€…å»ºè®®ï¼šç”Ÿäº§ç¯å¢ƒåº”å°½é‡é¿å…è¿›å…¥å®¹å™¨ç›´æ¥æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡ï¼š
- æ—¥å¿—ç³»ç»ŸæŸ¥çœ‹æ—¥å¿—ï¼ˆå¦‚ `docker logs` æˆ–é›†ä¸­å¼æ—¥å¿—ï¼‰
- ç›‘æ§ç³»ç»ŸæŸ¥çœ‹çŠ¶æ€
- é‡æ–°éƒ¨ç½²è€Œéæ‰‹åŠ¨ä¿®æ”¹

#### 3. æ—  shell é•œåƒçš„å¤„ç†

æŸäº›ç²¾ç®€é•œåƒï¼ˆå¦‚åŸºäº `scratch` æˆ– `distroless`ï¼‰æ²¡æœ‰ shellï¼š

```bash
## è¿™ä¼šå¤±è´¥
$ docker exec -it myapp bash
OCI runtime exec failed: exec failed: unable to start container process: exec: "bash": executable file not found

## è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è°ƒè¯•å®¹å™¨ï¼ˆDocker Desktop æˆ– Kubernetes debugï¼‰
$ docker debug myapp
```

---

### å¸¸è§é—®é¢˜

#### Q: exec è¿›å…¥åçœ‹ä¸åˆ°å…¶ä»–ç»ˆç«¯çš„æ“ä½œ

è¿™æ˜¯æ­£å¸¸çš„ã€‚exec å¯åŠ¨çš„æ˜¯ç‹¬ç«‹è¿›ç¨‹ï¼Œå¤šä¸ª exec ä¼šè¯äº’ä¸å½±å“ã€‚

#### Q: å®¹å™¨æ²¡æœ‰ bash

å°è¯•ä½¿ç”¨ shï¼š

```bash
$ docker exec -it myapp /bin/sh
```

#### Q: éœ€è¦ root æƒé™

```bash
$ docker exec -u root -it myapp bash
```

---

### æœ¬ç« å°ç»“

| éœ€æ±‚ | æ¨èå‘½ä»¤ |
|------|---------|
| è¿›å…¥å®¹å™¨è°ƒè¯• | `docker exec -it å®¹å™¨å bash` |
| æ‰§è¡Œå•æ¡å‘½ä»¤ | `docker exec å®¹å™¨å å‘½ä»¤` |
| æŸ¥çœ‹ä¸»è¿›ç¨‹è¾“å‡º | `docker attach å®¹å™¨å`ï¼ˆæ…ç”¨ï¼‰ |

### å»¶ä¼¸é˜…è¯»

- [åå°è¿è¡Œ](5.2_daemon.md)ï¼šç†è§£å®¹å™¨ä¸»è¿›ç¨‹
- [æŸ¥çœ‹å®¹å™¨](ls.md)ï¼šåˆ—å‡ºå’Œè¿‡æ»¤å®¹å™¨
- [å®¹å™¨æ—¥å¿—](logs.md)ï¼šæŸ¥çœ‹å®¹å™¨è¾“å‡º
