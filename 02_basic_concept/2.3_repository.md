## Docker Registry

## Docker Registry

Docker Registry æ˜¯é•œåƒåˆ†å‘å’Œç®¡ç†çš„æ ¸å¿ƒç»„ä»¶ã€‚æœ¬èŠ‚å°†ä»‹ç» Registry çš„åŸºæœ¬æ¦‚å¿µã€å…¬å…±å’Œç§æœ‰æœåŠ¡çš„é€‰æ‹©ï¼Œä»¥åŠé•œåƒçš„å®‰å…¨ç®¡ç†ã€‚

### ä¸€å¥è¯ç†è§£ Registry

> **Docker Registry æ˜¯å­˜å‚¨å’Œåˆ†å‘ Docker é•œåƒçš„æœåŠ¡ï¼Œç±»ä¼¼äºä»£ç çš„ GitHub æˆ–åŒ…ç®¡ç†çš„ npmã€‚**

é•œåƒæ„å»ºå®Œæˆåï¼Œå¯ä»¥åœ¨å½“å‰æœºå™¨ä¸Šè¿è¡Œã€‚ä½†å¦‚æœéœ€è¦åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šä½¿ç”¨è¿™ä¸ªé•œåƒï¼Œå°±éœ€è¦ä¸€ä¸ªé›†ä¸­çš„å­˜å‚¨å’Œåˆ†å‘æœåŠ¡â€”â€”è¿™å°±æ˜¯ Docker Registryã€‚

### æ ¸å¿ƒæ¦‚å¿µ

#### Registryã€ä»“åº“ã€æ ‡ç­¾çš„å…³ç³»

### æ ¸å¿ƒæ¦‚å¿µ

è¦ç†Ÿç»ƒä½¿ç”¨ Docker Registryï¼Œé¦–å…ˆéœ€è¦ç†æ¸…å®ƒä¸ä»“åº“ï¼ˆRepositoryï¼‰ã€æ ‡ç­¾ï¼ˆTagï¼‰ä¹‹é—´çš„å…³ç³»ã€‚

#### Registryã€ä»“åº“ã€æ ‡ç­¾çš„å…³ç³»

Docker Registry ä¸­å¯ä»¥åŒ…å«å¤šä¸ª Repositoryï¼Œæ¯ä¸ª Repository å¯ä»¥åŒ…å«å¤šä¸ª Tagã€‚ä¸‹å›¾æ¸…æ™°åœ°å±•ç¤ºäº†å®ƒä»¬ä¹‹é—´çš„å±‚çº§å…³ç³»ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Registry                             â”‚
â”‚                      ï¼ˆå¦‚ Docker Hubï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Repositoryï¼ˆä»“åº“ï¼‰: nginx                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚ :latest â”‚  â”‚ :1.25   â”‚  â”‚ :1.24   â”‚  â”‚ :alpine â”‚   ...   â”‚   â”‚
â”‚  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Repositoryï¼ˆä»“åº“ï¼‰: mysql                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚  â”‚  â”‚ :latest â”‚  â”‚ :8.0    â”‚  â”‚ :5.7    â”‚   ...                â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| æ¦‚å¿µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **Registry** | å­˜å‚¨é•œåƒçš„æœåŠ¡ | Docker Hubã€ghcr.io |
| **Repositoryï¼ˆä»“åº“ï¼‰** | åŒä¸€è½¯ä»¶çš„é•œåƒé›†åˆ | `nginx`ã€`mysql`ã€`mycompany/myapp` |
| **Tagï¼ˆæ ‡ç­¾ï¼‰** | ä»“åº“å†…çš„ç‰ˆæœ¬æ ‡è¯† | `latest`ã€`1.25`ã€`alpine` |

#### é•œåƒçš„å®Œæ•´åç§°

#### é•œåƒçš„å®Œæ•´åç§°

ä¸€ä¸ªå®Œæ•´çš„ Docker é•œåƒåç§°ç”± Registry åœ°å€ã€ç”¨æˆ·å/ç»„ç»‡åã€ä»“åº“åå’Œæ ‡ç­¾ç»„æˆã€‚äº†è§£å…¶ç»“æ„æœ‰åŠ©äºæˆ‘ä»¬æ›´å‡†ç¡®åœ°å®šä½é•œåƒã€‚

```
[registryåœ°å€/][ç”¨æˆ·å/]ä»“åº“å[:æ ‡ç­¾]
```

ç¤ºä¾‹ï¼š

```bash
## å®Œæ•´æ ¼å¼

registry.example.com/mycompany/myapp:v1.2.3
â”‚                    â”‚         â”‚     â”‚
â”‚                    â”‚         â”‚     â””â”€â”€ æ ‡ç­¾
â”‚                    â”‚         â””â”€â”€ ä»“åº“å
â”‚                    â””â”€â”€ ç”¨æˆ·å/ç»„ç»‡å
â””â”€â”€ Registry åœ°å€

## Docker Hub å®˜æ–¹é•œåƒï¼ˆçœç•¥ registry å’Œç”¨æˆ·åï¼‰

nginx:1.25
ubuntu:24.04

## Docker Hub ç”¨æˆ·é•œåƒ

jwilder/nginx-proxy:latest

## å…¶ä»– Registry

ghcr.io/username/myapp:v1.0
gcr.io/google-containers/pause:3.6
```

> ğŸ’¡ **ç¬”è€…æç¤º**ï¼šå¦‚æœä¸æŒ‡å®š Registry åœ°å€ï¼Œé»˜è®¤ä½¿ç”¨ Docker Hubã€‚å¦‚æœä¸æŒ‡å®šæ ‡ç­¾ï¼Œé»˜è®¤ä½¿ç”¨ `latest`ã€‚

### å…¬å…± Registry æœåŠ¡

### å…¬å…± Registry æœåŠ¡

å…¬å…± Registry æœåŠ¡ä¸ºå¼€å‘è€…æä¾›äº†ä¾¿æ·çš„é•œåƒè·å–é€”å¾„ã€‚å…¶ä¸­æœ€è‘—åçš„æ˜¯ Docker Hubã€‚

#### Docker Hubï¼ˆé»˜è®¤ï¼‰

[Docker Hub](https://hub.docker.com/) æ˜¯æœ€å¤§çš„å…¬å…± Registryï¼Œä¹Ÿæ˜¯ Docker çš„é»˜è®¤ Registryã€‚

**ç‰¹ç‚¹**ï¼š
- æ‹¥æœ‰å¤§é‡[å®˜æ–¹é•œåƒ](https://hub.docker.com/search?q=&type=image&image_filter=official)ï¼ˆnginxã€mysqlã€redis ç­‰ï¼‰
- å…è´¹è´¦æˆ·å¯ä»¥åˆ›å»ºå…¬å¼€ä»“åº“
- ä»˜è´¹è´¦æˆ·æ”¯æŒç§æœ‰ä»“åº“

```bash
## ä» Docker Hub æ‹‰å–é•œåƒ

$ docker pull nginx              # å®˜æ–¹é•œåƒ
$ docker pull bitnami/redis      # ç¬¬ä¸‰æ–¹é•œåƒ

## æ¨é€é•œåƒåˆ° Docker Hub

$ docker login
$ docker push username/myapp:v1.0
```

#### å…¶ä»–å…¬å…± Registry

| Registry | åœ°å€ | è¯´æ˜ |
|----------|------|------|
| **GitHub Container Registry** | ghcr.io | GitHub æä¾›ï¼Œä¸ GitHub Actions é›†æˆå¥½ |
| **Google Container Registry** | gcr.io | Google Cloud æä¾›ï¼ŒKubernetes é•œåƒå¸¸ç”¨ |
| **Quay.io** | quay.io | Red Hat æä¾› |
| **é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡** | registry.cn-*.aliyuncs.com | å›½å†…è®¿é—®å¿« |
| **è…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡** | ccr.ccs.tencentyun.com | å›½å†…è®¿é—®å¿« |

### é•œåƒåŠ é€Ÿå™¨

ç”±äºç½‘ç»œåŸå› ï¼Œåœ¨å›½å†…ç›´æ¥è®¿é—® Docker Hub å¯èƒ½ä¼šå¾ˆæ…¢ã€‚å¯ä»¥é…ç½®**é•œåƒåŠ é€Ÿå™¨**ï¼ˆRegistry Mirrorï¼‰æ¥åŠ é€Ÿä¸‹è½½ã€‚

```json
// /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://your-accelerator-url"
  ]
}
```

è¯¦ç»†é…ç½®æ–¹æ³•è¯·å‚è€ƒ[é•œåƒåŠ é€Ÿå™¨](../install/3.9_mirror.md)ç« èŠ‚ã€‚

> âš ï¸ **ç¬”è€…æé†’**ï¼šé•œåƒåŠ é€Ÿå™¨çš„å¯ç”¨æ€§ç»å¸¸å˜åŒ–ï¼Œä½¿ç”¨å‰å»ºè®®å…ˆæµ‹è¯•æ˜¯å¦å¯ç”¨ã€‚

### ç§æœ‰ Registry

å‡ºäºå®‰å…¨å’Œéšç§çš„è€ƒè™‘ï¼Œä¼ä¸šå¾€å¾€éœ€è¦æ­å»ºè‡ªå·±çš„ç§æœ‰ Registryã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ­å»ºæ–¹æ¡ˆã€‚

#### å®˜æ–¹ Registry é•œåƒ

#### å®˜æ–¹ Registry é•œåƒ

Docker å®˜æ–¹æä¾›äº† [registry](https://hub.docker.com/_/registry/) é•œåƒï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºç§æœ‰ Registryï¼š

```bash
## å¯åŠ¨ä¸€ä¸ªæœ¬åœ° Registry

$ docker run -d -p 5000:5000 --name registry registry:2

## æ¨é€é•œåƒåˆ°æœ¬åœ° Registry

$ docker tag myapp:v1.0 localhost:5000/myapp:v1.0
$ docker push localhost:5000/myapp:v1.0

## ä»æœ¬åœ° Registry æ‹‰å–

$ docker pull localhost:5000/myapp:v1.0
```

#### ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ

å®˜æ–¹ Registry åŠŸèƒ½è¾ƒä¸ºåŸºç¡€ï¼Œä¼ä¸šç¯å¢ƒå¸¸ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | ç‰¹ç‚¹ |
|------|------|
| **[Harbor](https://goharbor.io/)** | CNCF é¡¹ç›®ï¼ŒåŠŸèƒ½å…¨é¢ï¼ˆç”¨æˆ·ç®¡ç†ã€æ¼æ´æ‰«æã€é•œåƒç­¾åï¼‰ |
| **[Nexus Repository](../repository/6.4_nexus3_registry.md)** | æ”¯æŒå¤šç§åˆ¶å“ç±»å‹ï¼ˆDockerã€Mavenã€npm ç­‰ï¼‰ |
| **äº‘å‚å•†æœåŠ¡** | é˜¿é‡Œäº‘ ACRã€è…¾è®¯äº‘ TCRã€AWS ECR ç­‰ |

ç¬”è€…å»ºè®®ï¼š
- å°å›¢é˜Ÿï¼šå¯ä»¥å…ˆç”¨å®˜æ–¹ Registryï¼Œå¤Ÿç”¨å³å¯
- ä¸­å¤§å‹å›¢é˜Ÿï¼šæ¨è Harborï¼ŒåŠŸèƒ½å®Œå–„ä¸”å¼€æºå…è´¹
- å·²ä½¿ç”¨äº‘æœåŠ¡ï¼šç›´æ¥ç”¨äº‘å‚å•†çš„ Registry æœåŠ¡æ›´çœå¿ƒ

### é•œåƒçš„æ¨é€å’Œæ‹‰å–

#### å®Œæ•´å·¥ä½œæµç¨‹

### é•œåƒçš„æ¨é€å’Œæ‹‰å–

æŒæ¡é•œåƒçš„æ¨é€ï¼ˆPushï¼‰å’Œæ‹‰å–ï¼ˆPullï¼‰æ˜¯ä½¿ç”¨ Docker Registry çš„åŸºæœ¬åŠŸã€‚

#### å®Œæ•´å·¥ä½œæµç¨‹

ä¸‹å›¾å±•ç¤ºäº†ä»å¼€å‘ç¯å¢ƒæ„å»ºé•œåƒï¼Œæ¨é€åˆ° Registryï¼Œå†åˆ°ç”Ÿäº§ç¯å¢ƒæ‹‰å–è¿è¡Œçš„å®Œæ•´æµç¨‹ã€‚

```
å¼€å‘è€…æœºå™¨                    Registry                    ç”Ÿäº§æœåŠ¡å™¨
     â”‚                           â”‚                             â”‚
     â”‚  docker build             â”‚                             â”‚
     â”‚  æ„å»ºé•œåƒ                  â”‚                             â”‚
     â”‚                           â”‚                             â”‚
     â”‚  docker push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                             â”‚
     â”‚  æ¨é€é•œåƒ                  â”‚  å­˜å‚¨é•œåƒ                   â”‚
     â”‚                           â”‚                             â”‚
     â”‚                           â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ docker pull â”‚
     â”‚                           â”‚                  æ‹‰å–é•œåƒ    â”‚
     â”‚                           â”‚                             â”‚
     â”‚                           â”‚                  docker run â”‚
     â”‚                           â”‚                  è¿è¡Œå®¹å™¨    â”‚
```

#### å¸¸ç”¨å‘½ä»¤

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
## ç™»å½• Registry

$ docker login                      # ç™»å½• Docker Hub
$ docker login registry.example.com # ç™»å½•å…¶ä»– Registry

## æ‹‰å–é•œåƒ

$ docker pull nginx:1.25

## æ ‡è®°é•œåƒï¼ˆå‡†å¤‡æ¨é€ï¼‰

$ docker tag myapp:latest registry.example.com/myteam/myapp:v1.0

## æ¨é€é•œåƒ

$ docker push registry.example.com/myteam/myapp:v1.0

## ç™»å‡º

$ docker logout
```

### é•œåƒçš„å®‰å…¨æ€§

### é•œåƒçš„å®‰å…¨æ€§

åœ¨ä½¿ç”¨å…¬å…±é•œåƒæˆ–ç»´æŠ¤ç§æœ‰é•œåƒæ—¶ï¼Œå®‰å…¨æ€§æ˜¯ä¸å®¹å¿½è§†çš„é‡è¦ç¯èŠ‚ã€‚

#### ä½¿ç”¨å®˜æ–¹é•œåƒ

Docker Hub çš„[å®˜æ–¹é•œåƒ](https://hub.docker.com/search?q=&type=image&image_filter=official)ï¼ˆæ ‡æœ‰ "Official Image" æ ‡è¯†ï¼‰ç»è¿‡ Docker å›¢é˜Ÿå®¡æ ¸ï¼Œç›¸å¯¹æ›´å®‰å…¨ã€‚

```bash
## å®˜æ–¹é•œåƒç¤ºä¾‹

nginx          # âœ… å®˜æ–¹
mysql          # âœ… å®˜æ–¹
redis          # âœ… å®˜æ–¹

## ç¬¬ä¸‰æ–¹é•œåƒï¼ˆéœ€è¦è‡ªè¡Œè¯„ä¼°å¯ä¿¡åº¦ï¼‰

bitnami/redis  # âš ï¸ éœ€è¦è¯„ä¼°
someuser/myapp # âš ï¸ éœ€è¦è¯„ä¼°
```

#### é•œåƒç­¾å

ä½¿ç”¨ Docker Content Trust (DCT) éªŒè¯é•œåƒæ¥æºï¼š

```bash
## å¯ç”¨é•œåƒç­¾åéªŒè¯

$ export DOCKER_CONTENT_TRUST=1

## æ­¤åçš„ pull/push ä¼šéªŒè¯ç­¾å

$ docker pull nginx:latest
```

#### æ¼æ´æ‰«æ

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
## ä½¿ç”¨ Docker Scout æ‰«æé•œåƒæ¼æ´

$ docker scout cves nginx:latest

## ä½¿ç”¨ Trivyï¼ˆå¼€æºå·¥å…·ï¼‰

$ trivy image nginx:latest
```

### æœ¬ç« å°ç»“

| æ¦‚å¿µ | è¦ç‚¹ |
|------|------|
| **Registry** | å­˜å‚¨å’Œåˆ†å‘é•œåƒçš„æœåŠ¡ |
| **ä»“åº“ï¼ˆRepositoryï¼‰** | åŒä¸€è½¯ä»¶çš„é•œåƒé›†åˆ |
| **æ ‡ç­¾ï¼ˆTagï¼‰** | ç‰ˆæœ¬æ ‡è¯†ï¼Œé»˜è®¤ä¸º latest |
| **Docker Hub** | é»˜è®¤çš„å…¬å…± Registry |
| **ç§æœ‰ Registry** | ä¼ä¸šå†…éƒ¨ä½¿ç”¨ï¼Œæ¨è Harbor |

ç°åœ¨ä½ å·²ç»äº†è§£äº† Docker çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š[é•œåƒ](2.1_image.md)ã€[å®¹å™¨](2.2_container.md)å’Œä»“åº“ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å¼€å§‹[å®‰è£… Docker](../install/README.md)ï¼ŒåŠ¨æ‰‹å®è·µï¼

### å»¶ä¼¸é˜…è¯»

- [Docker Hub](../repository/6.1_dockerhub.md)ï¼šDocker Hub çš„è¯¦ç»†ä½¿ç”¨
- [ç§æœ‰ä»“åº“](../repository/6.2_registry.md)ï¼šæ­å»ºç§æœ‰ Registry
- [ç§æœ‰ä»“åº“é«˜çº§é…ç½®](../repository/6.3_registry_auth.md)ï¼šè®¤è¯ã€TLS é…ç½®
- [é•œåƒåŠ é€Ÿå™¨](../install/3.9_mirror.md)ï¼šé…ç½®é•œåƒåŠ é€Ÿ
